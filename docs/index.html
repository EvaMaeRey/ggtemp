<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="What the package does (one paragraph).">
<title>What the Package Does (One Line, Title Case) â€¢ ggtemp</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="deps/Atkinson_Hyperlegible-0.4.5/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="What the Package Does (One Line, Title Case)">
<meta property="og:description" content="What the package does (one paragraph).">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">ggtemp</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/EvaMaeRey/ggtemp/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><p>Proposing the {ggtemp} package! ðŸ¦„ <!-- (typical package introduction write up; but actually aspirational) --></p>
<p>The goal of {ggtemp} is to make writing some quick, useful extension functions succinctly (right now writing new stat_* and geom_* layers are the focus.</p>
<p>Currently, the amount of code required to write some extensions is a bit of a mouthful, and could feel prohibitive for day-to-day analysis scripts. Specifically, defining new geom_* and stat_* layers outside of the context of a package, I believe, is not common, but could be quite useful, ultimately making plot builds themselves intuitive and fun, and code more readable. However the usual amount of code required to make define new geom_* or stat_* functions, might feel like it â€˜gunks upâ€™ your script currently.</p>
<p>With the {ggtemp} package, weâ€™ll live in a different world (ðŸ¦„ ðŸ¦„ ðŸ¦„) where the task is a snap ðŸ«°, and the readability of the in-script definition of a geom_* or stat_* function is quite succinct:</p>
<p>Proposed API where we create a new geom_* layer function.</p>
<p>Related:</p>
<ol start="0" style="list-style-type: decimal">
<li><a href="https://evamaerey.github.io/mytidytuesday/2024-01-22-insta-geom/insta-geom.html" class="external-link">First experiment sketch</a></li>
<li><a href="https://eliocamp.github.io/codigo-r/en/2018/05/how-to-make-a-generic-stat-in-ggplot2/" class="external-link">Elio Câ€™s Stat Rasa (June Choe refered me to this cool post!)</a></li>
<li>I enjoyed <a href="https://evamaerey.github.io/mytidytuesday/2024-02-05-ggexpress-follow-up/ggexpress-follow-up.html" class="external-link">working with StatRasa in my sketchbook</a>
</li>
<li>
<a href="https://evamaerey.github.io/ggplot2-extension-cookbook/" class="external-link">ggplot2 extension cookbook</a> might serve as reference for long-form syntax.</li>
</ol>
<div class="section level3">
<h3 id="issues-and-where-this-all-might-be-going">Issues and where this all might be going:<a class="anchor" aria-label="anchor" href="#issues-and-where-this-all-might-be-going"></a>
</h3>
<p>There doesnâ€™t seem to be a complete match of the full functionality of the layers. For example, you have to write mapping = aes() to specify the aesthetic mapping within the layer.</p>
<ol style="list-style-type: decimal">
<li>Maybe we can fix this.</li>
<li>Maybe the temp utilities can be used for prototyping, and then we return to the more conventional syntax</li>
</ol>
<!-- end list --><div class="sourceCode" id="cb1"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(ggtemp)</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co"># 1. work out some compute</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>compute_group_xmean &lt;-<span class="st"> </span><span class="cf">function</span>(data, scales){</span>
<span id="cb1-5"><a href="#cb1-5"></a>  </span>
<span id="cb1-6"><a href="#cb1-6"></a>  data <span class="op">|</span><span class="er">&gt;</span><span class="st"> </span><span class="co"># a dataframe with vars x, the required aesthetic</span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">x =</span> <span class="kw">mean</span>(x)) <span class="op">|</span><span class="er">&gt;</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">xend =</span> x) <span class="op">|</span><span class="er">&gt;</span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">y =</span> <span class="op">-</span><span class="ot">Inf</span>, <span class="dt">yend =</span> <span class="ot">Inf</span>)</span>
<span id="cb1-10"><a href="#cb1-10"></a></span>
<span id="cb1-11"><a href="#cb1-11"></a>}</span>
<span id="cb1-12"><a href="#cb1-12"></a></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="co"># 2. create layer function based on compute geom_xmean)</span></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="kw">create_layer_temp</span>(<span class="dt">fun_name =</span> <span class="st">"geom_xmean"</span>,</span>
<span id="cb1-15"><a href="#cb1-15"></a>                  <span class="dt">compute_group =</span> compute_group_xmean,</span>
<span id="cb1-16"><a href="#cb1-16"></a>                  <span class="dt">required_aes =</span> <span class="st">"x"</span>,</span>
<span id="cb1-17"><a href="#cb1-17"></a>                  <span class="dt">geom_defaut =</span> <span class="st">"segment"</span>)</span>
<span id="cb1-18"><a href="#cb1-18"></a>                  </span>
<span id="cb1-19"><a href="#cb1-19"></a>                  </span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="co"># 3. Use temp layer!                   </span></span>
<span id="cb1-21"><a href="#cb1-21"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> cars) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1-22"><a href="#cb1-22"></a><span class="st">  </span><span class="kw">aes</span>(<span class="dt">x =</span> speed, <span class="dt">y =</span> dist) <span class="op">+</span><span class="st"> </span></span>
<span id="cb1-23"><a href="#cb1-23"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb1-24"><a href="#cb1-24"></a><span class="st">  </span><span class="kw">geom_xmean</span>()</span></code></pre></div>
</div>
<div class="section level1">
<div class="page-header"><h1 id="part-i-work-out-functionality-">Part I. Work out functionality âœ…<a class="anchor" aria-label="anchor" href="#part-i-work-out-functionality-"></a>
</h1></div>
<div class="section level2">
<h2 id="intro-thoughts">Intro Thoughts<a class="anchor" aria-label="anchor" href="#intro-thoughts"></a>
</h2>
<p>What if you just want to define a basic computational engine (geom_* or stat_* function) on the fly in a script. It seems like it requires a good amount of code, but there are things that repeat. Below, we see if we define a StatTemp within a function, and use that function to remove some of the repetition for vanilla-y extensions.</p>
<p>TLDR: This seems to work, and surprisingly well (??). I thought Iâ€™d only be able to use StatTemp once, but you seem to be able to define multiple geoms_* functions with the same define_temp_geom wrapperâ€¦</p>
</div>
<div class="section level2">
<h2 id="status-quo-1-compute-2-ggproto-3-define-layer">Status Quo: 1. compute, 2. ggproto, 3. define layer<a class="anchor" aria-label="anchor" href="#status-quo-1-compute-2-ggproto-3-define-layer"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="va">compute_panel_equilateral</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">scales</span>, <span class="va">n</span> <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html" class="external-link">crossing</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>z <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>around <span class="op">=</span> <span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">z</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">around</span><span class="op">)</span><span class="op">*</span><span class="va">r</span>,</span>
<span>           y <span class="op">=</span> <span class="va">y0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">around</span><span class="op">)</span><span class="op">*</span><span class="va">r</span><span class="op">)</span> </span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">StatCircle</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggproto.html" class="external-link">ggproto</a></span><span class="op">(</span></span>
<span>  `_class` <span class="op">=</span> <span class="st">"StatCircle"</span>,</span>
<span>  `_inherit` <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="https://ggplot2.tidyverse.org/reference/ggplot2-ggproto.html" class="external-link">Stat</a></span>,</span>
<span>  compute_panel <span class="op">=</span> <span class="va">compute_panel_equilateral</span>,</span>
<span>  required_aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x0"</span>, <span class="st">"y0"</span>, <span class="st">"r"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">geom_circle</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>  <span class="va">mapping</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">data</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">position</span> <span class="op">=</span> <span class="st">"identity"</span>,</span>
<span>  <span class="va">na.rm</span> <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">show.legend</span> <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  <span class="va">inherit.aes</span> <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html" class="external-link">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="va">StatCircle</span>,  <span class="co"># proto object from Step 2</span></span>
<span>    geom <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="https://ggplot2.tidyverse.org/reference/ggplot2-ggproto.html" class="external-link">GeomPolygon</a></span>,  <span class="co"># inherit other behavior</span></span>
<span>    data <span class="op">=</span> <span class="va">data</span>,</span>
<span>    mapping <span class="op">=</span> <span class="va">mapping</span>,</span>
<span>    position <span class="op">=</span> <span class="va">position</span>,</span>
<span>    show.legend <span class="op">=</span> <span class="va">show.legend</span>,</span>
<span>    inherit.aes <span class="op">=</span> <span class="va">inherit.aes</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>na.rm <span class="op">=</span> <span class="va">na.rm</span>, <span class="va">...</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, y0 <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, r <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">x0</span>, y0 <span class="op">=</span> <span class="va">y0</span>, r <span class="op">=</span> <span class="va">r</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_circle</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">r</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/cars-1.png"><!-- --></p>
</div>
<div class="section level2">
<h2 id="experimental-define_layer_temp-combines-2-and-3-in-using-a-temp-stat-under-the-hood">Experimental: <code>define_layer_temp()</code> combines 2 and 3 in using a temp Stat under the hood<a class="anchor" aria-label="anchor" href="#experimental-define_layer_temp-combines-2-and-3-in-using-a-temp-stat-under-the-hood"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">define_layer_temp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>  <span class="va">default_aes</span> <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">required_aes</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">dropped_aes</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>  <span class="va">optional_aes</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">non_missing_aes</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">compute_group</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">compute_panel</span> <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>  <span class="va">compute_layer</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">setup_data</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="co"># finish_layer = # we'll work on making these stat ggproto slots accessible too</span></span>
<span>  <span class="co"># retransform</span></span>
<span>  <span class="co"># extra_params =</span></span>
<span>  <span class="co"># setup_params</span></span>
<span>  <span class="co"># parameters</span></span>
<span>  <span class="va">geom</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">geom_default</span> <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="https://ggplot2.tidyverse.org/reference/ggplot2-ggproto.html" class="external-link">GeomPoint</a></span>, </span>
<span>  <span class="va">mapping</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">data</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">position</span> <span class="op">=</span> <span class="st">"identity"</span>,</span>
<span>  <span class="va">na.rm</span> <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">show.legend</span> <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  <span class="va">inherit.aes</span> <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>  </span>
<span>  <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span><span class="va">StatTemp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggproto.html" class="external-link">ggproto</a></span><span class="op">(</span></span>
<span>  `_class` <span class="op">=</span> <span class="st">"StatTemp"</span>,</span>
<span>  `_inherit` <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="https://ggplot2.tidyverse.org/reference/ggplot2-ggproto.html" class="external-link">Stat</a></span>,</span>
<span>  default_aes <span class="op">=</span> <span class="va">default_aes</span>,</span>
<span>  required_aes <span class="op">=</span> <span class="va">required_aes</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">compute_group</span><span class="op">)</span><span class="op">)</span><span class="op">{</span><span class="va">StatTemp</span><span class="op">$</span><span class="va">compute_group</span> <span class="op">&lt;-</span> <span class="va">compute_group</span><span class="op">}</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">compute_panel</span><span class="op">)</span><span class="op">)</span><span class="op">{</span><span class="va">StatTemp</span><span class="op">$</span><span class="va">compute_panel</span> <span class="op">&lt;-</span> <span class="va">compute_panel</span><span class="op">}</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">compute_layer</span><span class="op">)</span><span class="op">)</span><span class="op">{</span><span class="va">StatTemp</span><span class="op">$</span><span class="va">compute_layer</span> <span class="op">&lt;-</span> <span class="va">compute_layer</span><span class="op">}</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">setup_data</span><span class="op">)</span><span class="op">)</span><span class="op">{</span><span class="va">StatTemp</span><span class="op">$</span><span class="va">setup_data</span> <span class="op">&lt;-</span> <span class="va">setup_data</span><span class="op">}</span></span>
<span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">geom</span><span class="op">)</span><span class="op">)</span><span class="op">{</span><span class="va">geom</span> <span class="op">&lt;-</span> <span class="va">geom_default</span><span class="op">}</span></span>
<span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer.html" class="external-link">layer</a></span><span class="op">(</span></span>
<span>    stat <span class="op">=</span> <span class="va">StatTemp</span>, </span>
<span>    geom <span class="op">=</span> <span class="va">geom</span>, </span>
<span>    data <span class="op">=</span> <span class="va">data</span>,</span>
<span>    mapping <span class="op">=</span> <span class="va">mapping</span>,</span>
<span>    position <span class="op">=</span> <span class="va">position</span>,</span>
<span>    show.legend <span class="op">=</span> <span class="va">show.legend</span>,</span>
<span>    inherit.aes <span class="op">=</span> <span class="va">inherit.aes</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>na.rm <span class="op">=</span> <span class="va">na.rm</span>, <span class="va">...</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level3">
<h3 id="try-it-out">Try it out<a class="anchor" aria-label="anchor" href="#try-it-out"></a>
</h3>
<div class="section level4">
<h4 id="abbreviated-definition-geom_circle-using-define_layer_temp">abbreviated definition <code>geom_circle()</code> using <code>define_layer_temp</code>
<a class="anchor" aria-label="anchor" href="#abbreviated-definition-geom_circle-using-define_layer_temp"></a>
</h4>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compute_panel_circle</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">scales</span>, <span class="va">n</span> <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html" class="external-link">crossing</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>z <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>around <span class="op">=</span> <span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">z</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">around</span><span class="op">)</span><span class="op">*</span><span class="va">r</span>,</span>
<span>           y <span class="op">=</span> <span class="va">y0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">around</span><span class="op">)</span><span class="op">*</span><span class="va">r</span><span class="op">)</span> </span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">geom_circle</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="fu">define_layer_temp</span><span class="op">(</span></span>
<span>    required_aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x0"</span>, <span class="st">"y0"</span>, <span class="st">"r"</span><span class="op">)</span>,</span>
<span>    compute_panel <span class="op">=</span> <span class="va">compute_panel_circle</span>,</span>
<span>    geom_default <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="https://ggplot2.tidyverse.org/reference/ggplot2-ggproto.html" class="external-link">GeomPath</a></span>,</span>
<span>    <span class="va">...</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="use-geom_circle">use <code>geom_circle()</code>
<a class="anchor" aria-label="anchor" href="#use-geom_circle"></a>
</h4>
<p>We see that the layers that are created can always have there geom switched (provided that required aes are computed in the background).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, y0 <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, r <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">x0</span>, y0 <span class="op">=</span> <span class="va">y0</span>, r <span class="op">=</span> <span class="va">r</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_circle</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">r</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-3-1.png"><!-- --></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/last_plot.html" class="external-link">last_plot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_circle</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"point"</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-3-2.png"><!-- --></p>
</div>
</div>
<div class="section level3">
<h3 id="can-you-define-a-second-w-the-same-stattemp">Can you define a second w/ the same StatTempâ€¦<a class="anchor" aria-label="anchor" href="#can-you-define-a-second-w-the-same-stattemp"></a>
</h3>
<div class="section level4">
<h4 id="define-geom_heart">define geom_heart<a class="anchor" aria-label="anchor" href="#define-geom_heart"></a>
</h4>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compute_panel_heart</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">scales</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html" class="external-link">crossing</a></span><span class="op">(</span>around <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">15</span><span class="op">/</span><span class="fl">15</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      y <span class="op">=</span> <span class="va">y0</span> <span class="op">+</span> <span class="va">r</span> <span class="op">*</span> <span class="op">(</span></span>
<span>        <span class="fl">.85</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">around</span><span class="op">)</span></span>
<span>        <span class="op">-</span> <span class="fl">.35</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">around</span><span class="op">)</span></span>
<span>        <span class="op">-</span> <span class="fl">.25</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="fl">3</span> <span class="op">*</span> <span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">around</span><span class="op">)</span></span>
<span>        <span class="op">-</span> <span class="fl">.05</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="fl">4</span> <span class="op">*</span> <span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">around</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      x <span class="op">=</span> <span class="va">x0</span> <span class="op">+</span> <span class="va">r</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">around</span><span class="op">)</span><span class="op">^</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">geom_heart</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>    <span class="fu">define_layer_temp</span><span class="op">(</span></span>
<span>      required_aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x0"</span>, <span class="st">"y0"</span>, <span class="st">"r"</span><span class="op">)</span>,</span>
<span>      compute_panel <span class="op">=</span> <span class="va">compute_panel_heart</span>,</span>
<span>      geom_default <span class="op">=</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="https://ggplot2.tidyverse.org/reference/ggplot2-ggproto.html" class="external-link">GeomPolygon</a></span>,</span>
<span>      <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span>  <span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="try-using-both-geom_heart-and-geom_circle-together">try using both geom_heart and geom_circle togetherâ€¦<a class="anchor" aria-label="anchor" href="#try-using-both-geom_heart-and-geom_circle-together"></a>
</h4>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, y0 <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, r <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">x0</span>, y0 <span class="op">=</span> <span class="va">y0</span>, r <span class="op">=</span> <span class="va">r</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_heart</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_circle</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"red"</span>, </span>
<span>              data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="fl">4</span>,y0 <span class="op">=</span> <span class="fl">2</span>, r <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"point"</span>, x <span class="op">=</span> <span class="fl">.5</span>, y <span class="op">=</span> <span class="fl">.5</span>, size <span class="op">=</span> <span class="fl">8</span>, color <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-5-1.png"><!-- --></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="and-create_layer_temp-method-even-more-experimental-but-feeling-nicer-to-use">And <code>create_layer_temp</code> method, even more experimental (but feeling nicer to use)<a class="anchor" aria-label="anchor" href="#and-create_layer_temp-method-even-more-experimental-but-feeling-nicer-to-use"></a>
</h2>
<div class="section level3">
<h3 id="first-just-checking-out-how-assign-works">First just checking out how assign works.<a class="anchor" aria-label="anchor" href="#first-just-checking-out-how-assign-works"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/assign.html" class="external-link">assign</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"geom_circle"</span>, </span>
<span>       value <span class="op">=</span> </span>
<span>  </span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="fu">define_layer_temp</span><span class="op">(</span></span>
<span>    required_aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x0"</span>, <span class="st">"y0"</span>, <span class="st">"r"</span><span class="op">)</span>,</span>
<span>    compute_panel <span class="op">=</span> <span class="va">compute_panel_circle</span>,</span>
<span>    geom_default <span class="op">=</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="https://ggplot2.tidyverse.org/reference/ggplot2-ggproto.html" class="external-link">GeomPath</a></span>,</span>
<span>    <span class="va">...</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="wrapping-this">wrapping thisâ€¦<a class="anchor" aria-label="anchor" href="#wrapping-this"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">create_layer_temp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">fun_name</span> <span class="op">=</span><span class="st">"geom_circle"</span>, </span>
<span>                              <span class="va">compute_panel</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                              <span class="va">compute_group</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                              <span class="va">required_aes</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                              <span class="va">default_aes</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                              <span class="va">geom_default</span> <span class="op">=</span><span class="st">"point"</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html" class="external-link">assign</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">fun_name</span>, </span>
<span>         value <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>           </span>
<span>  <span class="fu">define_layer_temp</span><span class="op">(</span></span>
<span>    required_aes <span class="op">=</span> <span class="va">required_aes</span>,</span>
<span>    default_aes <span class="op">=</span> <span class="va">default_aes</span>, </span>
<span>    compute_panel <span class="op">=</span> <span class="va">compute_panel</span>,</span>
<span>    compute_group <span class="op">=</span> <span class="va">compute_group</span>,</span>
<span>    geom_default <span class="op">=</span> <span class="va">geom_default</span>,</span>
<span>    <span class="va">...</span><span class="op">)</span>  <span class="op">}</span>,</span>
<span>  pos <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level4">
<h4 id="and-trying-it-out">and trying it out<a class="anchor" aria-label="anchor" href="#and-trying-it-out"></a>
</h4>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">create_layer_temp</span><span class="op">(</span>fun_name <span class="op">=</span> <span class="st">"stat_circle"</span>,</span>
<span>                  required_aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x0"</span>, <span class="st">"y0"</span>, <span class="st">"r"</span><span class="op">)</span>,</span>
<span>                  compute_panel <span class="op">=</span> <span class="va">compute_panel_circle</span>,</span>
<span>                  geom_default <span class="op">=</span><span class="st">"polygon"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">cars</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">speed</span>, y0 <span class="op">=</span>  <span class="va">dist</span>, r <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">stat_circle</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.4</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-7-1.png"><!-- --></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="lets-do-star-example">Letâ€™s do star example!<a class="anchor" aria-label="anchor" href="#lets-do-star-example"></a>
</h2>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compute_panel_star</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">scales</span>, <span class="va">n_points</span> <span class="op">=</span> <span class="fl">5</span>, <span class="va">prop_inner_r</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="va">n_vertices</span> <span class="op">&lt;-</span> <span class="va">n_points</span> <span class="op">*</span> <span class="fl">2</span></span>
<span>  </span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html" class="external-link">crossing</a></span><span class="op">(</span>around <span class="op">=</span> <span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">n_vertices</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">n_vertices</span><span class="op">)</span><span class="op">+</span><span class="va">pi</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      y <span class="op">=</span> <span class="va">y</span> <span class="op">+</span> <span class="op">(</span><span class="va">r</span> <span class="op">-</span> <span class="va">r</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">.35</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>                <span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">around</span><span class="op">)</span> ,</span>
<span>      x <span class="op">=</span> <span class="va">x</span> <span class="op">+</span> <span class="op">(</span><span class="va">r</span> <span class="op">-</span> <span class="va">r</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">.35</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>                <span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">around</span><span class="op">)</span></span>
<span>      <span class="op">)</span> </span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">create_layer_temp</span><span class="op">(</span>fun_name <span class="op">=</span> <span class="st">"geom_star"</span>, </span>
<span>                  compute_panel <span class="op">=</span> <span class="va">compute_panel_star</span>,</span>
<span>                  required_aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"r"</span><span class="op">)</span>,</span>
<span>                  geom_default <span class="op">=</span><span class="st">"polygon"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">cars</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span>,<span class="op">]</span> <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">speed</span>, y <span class="op">=</span>  <span class="va">dist</span>, r <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_star</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-8-1.png"><!-- --></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/last_plot.html" class="external-link">last_plot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_star</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"point"</span>, color <span class="op">=</span> <span class="st">"magenta"</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-8-2.png"><!-- --></p>
<div class="section level3">
<h3 id="a-point-with-no-required-aes">A point with no required aes<a class="anchor" aria-label="anchor" href="#a-point-with-no-required-aes"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compute_group_point</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">scales</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">{</span><span class="va">data</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">0</span><span class="op">}</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">{</span><span class="va">data</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">0</span><span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">data</span> </span>
<span>  </span>
<span><span class="op">}</span> </span>
<span></span>
<span><span class="va">cars</span> <span class="op">|&gt;</span></span>
<span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">speed</span>, y <span class="op">=</span> <span class="va">dist</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">compute_group_point</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;     x   y</span></span>
<span><span class="co">#&gt; 1   4   2</span></span>
<span><span class="co">#&gt; 2   4  10</span></span>
<span><span class="co">#&gt; 3   7   4</span></span>
<span><span class="co">#&gt; 4   7  22</span></span>
<span><span class="co">#&gt; 5   8  16</span></span>
<span><span class="co">#&gt; 6   9  10</span></span>
<span><span class="co">#&gt; 7  10  18</span></span>
<span><span class="co">#&gt; 8  10  26</span></span>
<span><span class="co">#&gt; 9  10  34</span></span>
<span><span class="co">#&gt; 10 11  17</span></span>
<span><span class="co">#&gt; 11 11  28</span></span>
<span><span class="co">#&gt; 12 12  14</span></span>
<span><span class="co">#&gt; 13 12  20</span></span>
<span><span class="co">#&gt; 14 12  24</span></span>
<span><span class="co">#&gt; 15 12  28</span></span>
<span><span class="co">#&gt; 16 13  26</span></span>
<span><span class="co">#&gt; 17 13  34</span></span>
<span><span class="co">#&gt; 18 13  34</span></span>
<span><span class="co">#&gt; 19 13  46</span></span>
<span><span class="co">#&gt; 20 14  26</span></span>
<span><span class="co">#&gt; 21 14  36</span></span>
<span><span class="co">#&gt; 22 14  60</span></span>
<span><span class="co">#&gt; 23 14  80</span></span>
<span><span class="co">#&gt; 24 15  20</span></span>
<span><span class="co">#&gt; 25 15  26</span></span>
<span><span class="co">#&gt; 26 15  54</span></span>
<span><span class="co">#&gt; 27 16  32</span></span>
<span><span class="co">#&gt; 28 16  40</span></span>
<span><span class="co">#&gt; 29 17  32</span></span>
<span><span class="co">#&gt; 30 17  40</span></span>
<span><span class="co">#&gt; 31 17  50</span></span>
<span><span class="co">#&gt; 32 18  42</span></span>
<span><span class="co">#&gt; 33 18  56</span></span>
<span><span class="co">#&gt; 34 18  76</span></span>
<span><span class="co">#&gt; 35 18  84</span></span>
<span><span class="co">#&gt; 36 19  36</span></span>
<span><span class="co">#&gt; 37 19  46</span></span>
<span><span class="co">#&gt; 38 19  68</span></span>
<span><span class="co">#&gt; 39 20  32</span></span>
<span><span class="co">#&gt; 40 20  48</span></span>
<span><span class="co">#&gt; 41 20  52</span></span>
<span><span class="co">#&gt; 42 20  56</span></span>
<span><span class="co">#&gt; 43 20  64</span></span>
<span><span class="co">#&gt; 44 22  66</span></span>
<span><span class="co">#&gt; 45 23  54</span></span>
<span><span class="co">#&gt; 46 24  70</span></span>
<span><span class="co">#&gt; 47 24  92</span></span>
<span><span class="co">#&gt; 48 24  93</span></span>
<span><span class="co">#&gt; 49 24 120</span></span>
<span><span class="co">#&gt; 50 25  85</span></span>
<span></span>
<span></span>
<span><span class="fu">create_layer_temp</span><span class="op">(</span>fun_name <span class="op">=</span> <span class="st">"geom_point2"</span>,</span>
<span>                           compute_group <span class="op">=</span> <span class="va">compute_group_point</span>,</span>
<span>                           required_aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                           default_aes <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>,</span>
<span>                           geom_default <span class="op">=</span> <span class="st">"point"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">cars</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point2</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.7</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-9-1.png"><!-- --></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/last_plot.html" class="external-link">last_plot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">speed</span><span class="op">)</span> </span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-9-2.png"><!-- --></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/last_plot.html" class="external-link">last_plot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">dist</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-9-3.png"><!-- --></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/last_plot.html" class="external-link">last_plot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-9-4.png"><!-- --></p>
<!-- ### a cute musical example... --><!-- ```{r, fig.width=12, fig.height=7} --><!-- twinkle_little_star_drm <- "ddsslls ffmmrrd" --><!-- twinkle_lyrics <- "Twin-kle twin-kle lit-tle star --><!-- How I won-der what you are" --><!-- twinkle_little_star_drm |> --><!-- ggdoremi:::join_phrases_drm_lyrics(twinkle_lyrics) |> --><!--  ggplot() +  --><!--    aes(y = drm, x = id_in_phrase, r = .58, label = lyric) +  --><!--    facet_wrap(~id_phrase) +  --><!--   geom_star(alpha = .4) + --><!--   geom_text(size = 5) + --><!--   coord_equal() +  --><!--   aes(fill = doremi, color = doremi) --><!-- last_plot()$data |> head() --><!-- ``` --><!-- ```{r, fig.width=11, fig.height=6.5} --><!-- compute_panel_heart <- function(data, scales){ --><!--   data %>% --><!--   mutate(group = row_number()) %>% --><!--   tidyr::crossing(around = 0:30/30) %>% --><!--     dplyr::mutate( --><!--       y = y + r*.8 * ( --><!--         .85 * cos(2*pi*around) --><!--         - .3 * cos(2 * 2*pi*around) --><!--         - .2 * cos(3 * 2*pi*around) --><!--         - .05 * cos(4 * 2*pi*around) --><!--       ), --><!--       x = x + r * (sin(2*pi*around)^3)) --><!-- } --><!-- create_layer_temp(fun_name = "geom_heart",  --><!--                   compute_panel = compute_panel_heart, --><!--                   required_aes = c("x", "y", "r"), --><!--                   geom_default ="polygon") --><!-- alphabet_drm <- "ddsslls ffmmrrrrd ssfmmr sfmmr ddsslls ffmmrrd" --><!-- alphabet_lyrics <-  --><!-- "A B C D E F G --><!-- H I J K L M N O P --><!-- Q R S T U V --><!-- W X Y & Z --><!-- Val-en-tine's Day A B C's --><!-- A few hearts for you from me!" --><!-- alphabet_drm |> --><!--   ggdoremi:::join_phrases_drm_lyrics(alphabet_lyrics) |> --><!--  ggplot() +  --><!--    aes(y = as.numeric(drm), x = id_in_phrase, r = .58, label = lyric) +  --><!--    facet_wrap(~id_phrase, scales = "free_x") +  --><!--   geom_hline(yintercept = c(8,10,12), color = "grey") +  --><!--   geom_line(color = "black", linetype = "dashed") + --><!--   geom_heart(fill = "white", color = "black", alpha = 1) + --><!--   geom_text(size = 3, nudge_y = -.05, aes(alpha = nchar(lyric) > 1 | lyric %in% letters[1:4] | lyric == "&" |lyric %in% LETTERS[1:4]), show.legend = F) + --><!--   # coord_equal() +  --><!--   # aes(fill = doremi, color = doremi) + --><!--   ggstamp::theme_void_fill("white") + --><!--   theme(text = element_text(color = "white")) +  --><!--   theme(panel.spacing.x = unit(0, "in")) --><!-- ``` -->
</div>
</div>
</div>
<div class="section level1">
<h1 id="geom_xmean-on-the-fly-with-compute-group">geom_xmean on the fly with compute groupâ€¦<a class="anchor" aria-label="anchor" href="#geom_xmean-on-the-fly-with-compute-group"></a>
</h1>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. write some compute</span></span>
<span><span class="va">compute_group_xmean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">scales</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="va">x</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>y <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, yend <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># 2. define function</span></span>
<span><span class="fu">create_layer_temp</span><span class="op">(</span>fun_name <span class="op">=</span> <span class="st">"geom_xmean"</span>,</span>
<span>                  compute_group <span class="op">=</span> <span class="va">compute_group_xmean</span>,</span>
<span>                  required_aes <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>                  geom_default <span class="op">=</span><span class="st">"segment"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. use function</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">cars</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">speed</span>, y <span class="op">=</span> <span class="va">dist</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_xmean</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">speed</span> <span class="op">&gt;</span> <span class="fl">18</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-10-1.png"><!-- --></p>
<div class="section level2">
<h2 id="compute_oval_minmax">compute_oval_minmax<a class="anchor" aria-label="anchor" href="#compute_oval_minmax"></a>
</h2>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compute_oval_minmax</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">scales</span>, <span class="va">n</span> <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>        x0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>,</span>
<span>        y0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>,</span>
<span>        rx <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span> ,</span>
<span>        ry <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="co"># mutate(group = row_number()) |&gt; </span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html" class="external-link">crossing</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>z <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>around <span class="op">=</span> <span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">z</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">around</span><span class="op">)</span><span class="op">*</span><span class="va">rx</span>,</span>
<span>           y <span class="op">=</span> <span class="va">y0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">around</span><span class="op">)</span><span class="op">*</span><span class="va">ry</span><span class="op">)</span> </span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">mtcars</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">wt</span>, y <span class="op">=</span> <span class="va">mpg</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">compute_oval_minmax</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 101 Ã— 8</span></span>
<span><span class="co">#&gt;       x0    y0    rx    ry     z around     x     y</span></span>
<span><span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1  3.47  22.2  1.96  11.8     0 0       5.42  22.2</span></span>
<span><span class="co">#&gt;  2  3.47  22.2  1.96  11.8     1 0.0628  5.42  22.9</span></span>
<span><span class="co">#&gt;  3  3.47  22.2  1.96  11.8     2 0.126   5.41  23.6</span></span>
<span><span class="co">#&gt;  4  3.47  22.2  1.96  11.8     3 0.188   5.39  24.4</span></span>
<span><span class="co">#&gt;  5  3.47  22.2  1.96  11.8     4 0.251   5.36  25.1</span></span>
<span><span class="co">#&gt;  6  3.47  22.2  1.96  11.8     5 0.314   5.33  25.8</span></span>
<span><span class="co">#&gt;  7  3.47  22.2  1.96  11.8     6 0.377   5.29  26.5</span></span>
<span><span class="co">#&gt;  8  3.47  22.2  1.96  11.8     7 0.440   5.24  27.2</span></span>
<span><span class="co">#&gt;  9  3.47  22.2  1.96  11.8     8 0.503   5.18  27.8</span></span>
<span><span class="co">#&gt; 10  3.47  22.2  1.96  11.8     9 0.565   5.12  28.4</span></span>
<span><span class="co">#&gt; # â„¹ 91 more rows</span></span>
<span></span>
<span><span class="co"># 2. define function</span></span>
<span><span class="fu">create_layer_temp</span><span class="op">(</span>fun_name <span class="op">=</span> <span class="st">"geom_oval_xy_range"</span>,</span>
<span>                  compute_group <span class="op">=</span> <span class="va">compute_oval_minmax</span>,</span>
<span>                  required_aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span><span class="op">)</span>,</span>
<span>                  geom_default <span class="op">=</span> <span class="st">"path"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">wt</span>, y <span class="op">=</span> <span class="va">mpg</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_oval_xy_range</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-11-1.png"><!-- --></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/last_plot.html" class="external-link">last_plot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">wt</span> <span class="op">&gt;</span> <span class="fl">3.4</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-11-2.png"><!-- --></p>
<!-- # Dates extension example - geom progression --><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="va">compute_group_progression</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">scales</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">data</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lead</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>yend <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lead</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> </span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="fu">create_layer_temp</span><span class="op">(</span>fun_name <span class="op">=</span> <span class="st">"stat_progression"</span>,</span>
<span>                  compute_group <span class="op">=</span> <span class="va">compute_group_progression</span>,</span>
<span>                  required_aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span><span class="op">)</span>,</span>
<span>                  geom_default <span class="op">=</span> <span class="st">"segment"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">geom_progression</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="fu">stat_progression</span><span class="op">(</span>arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span>ends <span class="op">=</span> <span class="st">"last"</span>, length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">.1</span>, <span class="st">"in"</span><span class="op">)</span><span class="op">)</span>,<span class="va">...</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span><span class="op">~</span><span class="va">event</span>, <span class="op">~</span><span class="va">date</span>,</span>
<span>                <span class="st">"Announcement"</span>, <span class="fl">0</span>,</span>
<span>                <span class="st">"deadline"</span>, <span class="fl">3</span>,</span>
<span>                <span class="st">"extended\ndeadline"</span>, <span class="fl">5</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="st">"Conf"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_progression</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">event</span><span class="op">)</span>, vjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-12-1.png"><!-- --></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span></span>
<span><span class="co"># And w/ stackoverflow example.</span></span>
<span><span class="co"># https://stackoverflow.com/questions/70249589/how-to-add-multiple-arrows-to-a-path-according-to-line-direction-using-ggplot2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>long <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.596</span>, <span class="fl">0.641</span>, <span class="fl">0.695</span>, <span class="fl">0.741</span>, <span class="fl">0.788</span>, <span class="fl">0.837</span>,</span>
<span>       <span class="fl">0.887</span>, <span class="fl">0.937</span>, <span class="fl">0.993</span>, <span class="fl">0.984</span>, <span class="fl">0.934</span>, <span class="fl">0.886</span>,</span>
<span>       <span class="fl">0.838</span>, <span class="fl">0.778</span>, <span class="fl">0.738</span>, <span class="fl">0.681</span>, <span class="fl">0.642</span>, <span class="fl">0.593</span><span class="op">)</span>,</span>
<span>       lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">23.630</span>, <span class="fl">24.085</span>, <span class="fl">24.643</span>, <span class="fl">25.067</span>, <span class="fl">25.491</span>, <span class="fl">25.899</span>,</span>
<span>       <span class="fl">26.305</span>, <span class="fl">26.670</span>, <span class="fl">27.049</span>, <span class="fl">27.025</span>, <span class="fl">26.836</span>, <span class="fl">26.636</span>,</span>
<span>       <span class="fl">26.429</span>, <span class="fl">26.152</span>, <span class="fl">25.965</span>, <span class="fl">25.664</span>, <span class="fl">25.442</span>, <span class="fl">24.510</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_progression</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-12-2.png"><!-- --></p>
</div>
</div>
<div class="section level1">
<h1 id="prop">prop<a class="anchor" aria-label="anchor" href="#prop"></a>
</h1>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">setup_data_prop</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">params</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">data</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"test"</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">compute_panel_prop</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">scales</span>, <span class="va">true_case</span> <span class="op">=</span> <span class="st">"Yes"</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span><span class="op">{</span><span class="va">data</span><span class="op">$</span><span class="va">weight</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">data</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>x_num_lab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">x</span> <span class="op">==</span> <span class="va">true_case</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">x_num_lab</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Titanic |&gt; </span></span>
<span><span class="co">#   data.frame() |&gt;</span></span>
<span><span class="co">#   summarise(weight = Freq, x = Survived) |&gt;</span></span>
<span><span class="co">#   compute_panel_prop()</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># create_layer_temp("geom_prop",</span></span>
<span><span class="co">#                   setup_data = setup_data_prop,</span></span>
<span><span class="co">#                   compute_panel = compute_panel_prop,</span></span>
<span><span class="co">#                   geom = "col")</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Titanic |&gt; </span></span>
<span><span class="co">#   data.frame() |&gt;</span></span>
<span><span class="co">#   ggplot() + </span></span>
<span><span class="co">#   aes(x = Survived, weight = Freq) + </span></span>
<span><span class="co">#   geom_prop()</span></span></code></pre></div>
<!-- # in 100 --><!-- ```{r} --><!-- tibble(outcome = sample(0:1, 1000, replace = T)) |> --><!--   count(outcome) |> --><!--   mutate(percent = round(100*n/sum(n))) |> --><!--   uncount(percent) |> --><!--   mutate(id = row_number()-1) |> --><!--   ggplot() +  --><!--   aes(x = id %% 10, y = id %/% 10) + --><!--   geom_tile() +  --><!--   aes(fill = outcome) --><!-- compute_panel_100 <- function(data, scales){ --><!--   data  |> --><!--   count(outcome) |> --><!--   mutate(percent = round(100*n/sum(n))) |> --><!--   uncount(percent) |> --><!--   mutate(id = row_number()-1) |> --><!--   mutate(x = id %% 10) |> --><!--   mutate(y = id %/% 10) |> --><!--   mutate(width = .7, height = .7) --><!-- } --><!-- create_layer_temp(fun_name = "geom_100", --><!--                   compute_panel = compute_panel_100, --><!--                   required_aes = c("outcome"), --><!--                   geom_default = "tile") --><!-- Titanic %>%  --><!--   as.data.frame() %>%  --><!--   uncount(Freq) |> --><!--   ggplot() +  --><!--   aes(outcome = Survived) +  --><!--   geom_100() +  --><!--   geom_100(geom = "text",  --><!--            mapping = aes(label = after_stat(outcome))) --><!-- last_plot() + --><!--   aes(fill = after_stat(outcome)) + --><!--   labs(fill = "Survived") --><!-- last_plot() +  --><!--   facet_wrap(~Sex) --><!-- last_plot() +  --><!--   facet_grid(Sex ~ Age)  --><!-- # fails, no propagation of alpha var... --><!-- last_plot() +  --><!--   aes(alpha = Age) --><!-- # Look at https://liamgilbey.github.io/ggwaffle/ --><!-- ``` --><!-- ### some more things to try --><!-- - Diverging bar chart... --><!-- - date input to month layout -->
</div>
<div class="section level1">
<h1 id="spatial-status-quo-of-ggplot2-extension-cookbook">spatial â€˜status quoâ€™ of ggplot2 extension cookbook<a class="anchor" aria-label="anchor" href="#spatial-status-quo-of-ggplot2-extension-cookbook"></a>
</h1>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">northcarolina_county_reference0</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"shape/nc.shp"</span>, package<span class="op">=</span><span class="st">"sf"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>county_name <span class="op">=</span> <span class="va">NAME</span>,</span>
<span>                fips <span class="op">=</span> <span class="va">FIPS</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">county_name</span>, <span class="va">fips</span>, <span class="va">geometry</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading layer `nc' from data source </span></span>
<span><span class="co">#&gt;   `/Library/Frameworks/R.framework/Versions/4.2/Resources/library/sf/shape/nc.shp' </span></span>
<span><span class="co">#&gt;   using driver `ESRI Shapefile'</span></span>
<span><span class="co">#&gt; Simple feature collection with 100 features and 14 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965</span></span>
<span><span class="co">#&gt; Geodetic CRS:  NAD27</span></span>
<span></span>
<span><span class="va">return_st_bbox_df</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sf_df</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">bb</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">sf_df</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">bb</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, ymin <span class="op">=</span> <span class="va">bb</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>             xmax <span class="op">=</span> <span class="va">bb</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, ymax <span class="op">=</span> <span class="va">bb</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">add_xy_coords</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">geo_df</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span><span class="va">geo_df</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_zm.html" class="external-link">st_zm</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_point_on_surface</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span></span>
<span>  <span class="va">points_sf</span></span>
<span></span>
<span><span class="va">the_coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">points_sf</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">geo_df</span>, <span class="va">the_coords</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">northcarolina_county_reference</span> <span class="op">&lt;-</span> <span class="va">northcarolina_county_reference0</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>bb <span class="op">=</span></span>
<span>                  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">geometry</span>,</span>
<span>                             <span class="va">return_st_bbox_df</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">bb</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_xy_coords</span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">compute_panel_county</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">scales</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">northcarolina_county_reference</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">StatNcfips</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggproto.html" class="external-link">ggproto</a></span><span class="op">(</span>`_class` <span class="op">=</span> <span class="st">"StatNcfips"</span>,</span>
<span>                                `_inherit` <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="https://ggplot2.tidyverse.org/reference/ggplot2-ggproto.html" class="external-link">Stat</a></span>,</span>
<span>                                required_aes <span class="op">=</span> <span class="st">"fips|county_name"</span>,</span>
<span>                                compute_panel <span class="op">=</span> <span class="va">compute_panel_county</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">stat_county</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>      <span class="va">mapping</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>      <span class="va">data</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>      <span class="va">geom</span> <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">GeomSf</a></span>,</span>
<span>      <span class="va">position</span> <span class="op">=</span> <span class="st">"identity"</span>,</span>
<span>      <span class="va">na.rm</span> <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      <span class="va">show.legend</span> <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>      <span class="va">inherit.aes</span> <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      <span class="va">crs</span> <span class="op">=</span> <span class="st">"NAD27"</span>, <span class="co"># "NAD27", 5070, "WGS84", "NAD83", 4326 , 3857</span></span>
<span>      <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer_sf.html" class="external-link">layer_sf</a></span><span class="op">(</span></span>
<span>              stat <span class="op">=</span> <span class="va">StatNcfips</span>,  <span class="co"># proto object from step 2</span></span>
<span>              geom <span class="op">=</span> <span class="va">geom</span>,  <span class="co"># inherit other behavior</span></span>
<span>              data <span class="op">=</span> <span class="va">data</span>,</span>
<span>              mapping <span class="op">=</span> <span class="va">mapping</span>,</span>
<span>              position <span class="op">=</span> <span class="va">position</span>,</span>
<span>              show.legend <span class="op">=</span> <span class="va">show.legend</span>,</span>
<span>              inherit.aes <span class="op">=</span> <span class="va">inherit.aes</span>,</span>
<span>              params <span class="op">=</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/list2.html" class="external-link">list2</a></span><span class="op">(</span>na.rm <span class="op">=</span> <span class="va">na.rm</span>, <span class="va">...</span><span class="op">)</span></span>
<span>              <span class="op">)</span>,</span>
<span>              </span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="va">crs</span>,</span>
<span>                       default_crs <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">crs</span><span class="op">)</span>,</span>
<span>                       datum <span class="op">=</span> <span class="va">crs</span>,</span>
<span>                       default <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>     <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span><span class="fu">ggnorthcarolina</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ggnorthcarolina/man/northcarolina_county_flat.html" class="external-link">northcarolina_county_flat</a></span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fips <span class="op">=</span> <span class="va">fips</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">stat_county</span><span class="op">(</span>crs <span class="op">=</span> <span class="st">"NAD83"</span><span class="op">)</span>  <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">SID74</span><span class="op">/</span><span class="va">BIR74</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">stat_county</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">'text'</span>, </span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">SID74</span><span class="op">)</span>,</span>
<span>              color <span class="op">=</span> <span class="st">"oldlace"</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-14-1.png"><!-- --></p>
</div>
<div class="section level1">
<h1 id="define_layer_sf_temp-build">define_layer_sf_temp build<a class="anchor" aria-label="anchor" href="#define_layer_sf_temp-build"></a>
</h1>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">northcarolina_county_reference0</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"shape/nc.shp"</span>, package<span class="op">=</span><span class="st">"sf"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>county_name <span class="op">=</span> <span class="va">NAME</span>,</span>
<span>                fips <span class="op">=</span> <span class="va">FIPS</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">county_name</span>, <span class="va">fips</span>, <span class="va">geometry</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading layer `nc' from data source </span></span>
<span><span class="co">#&gt;   `/Library/Frameworks/R.framework/Versions/4.2/Resources/library/sf/shape/nc.shp' </span></span>
<span><span class="co">#&gt;   using driver `ESRI Shapefile'</span></span>
<span><span class="co">#&gt; Simple feature collection with 100 features and 14 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965</span></span>
<span><span class="co">#&gt; Geodetic CRS:  NAD27</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">return_st_bbox_df</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">sf_df</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">bb</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">sf_df</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">bb</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, ymin <span class="op">=</span> <span class="va">bb</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>             xmax <span class="op">=</span> <span class="va">bb</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, ymax <span class="op">=</span> <span class="va">bb</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">add_xy_coords</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">geo_df</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span><span class="va">geo_df</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_zm.html" class="external-link">st_zm</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_point_on_surface</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span></span>
<span>  <span class="va">points_sf</span></span>
<span></span>
<span><span class="va">the_coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">points_sf</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">geo_df</span>, <span class="va">the_coords</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">define_layer_sf_temp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">ref_df</span>,</span>
<span>                                 <span class="va">geom</span> <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>                                 <span class="va">geom_default</span> <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">GeomSf</a></span>, </span>
<span>                                 <span class="va">required_aes</span>, </span>
<span>                                 <span class="va">default_aes</span> <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                                 <span class="va">stamp</span> <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 <span class="va">mapping</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                 <span class="va">data</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                 <span class="va">position</span> <span class="op">=</span> <span class="st">"identity"</span>,</span>
<span>                                 <span class="va">na.rm</span> <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                 <span class="va">show.legend</span> <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                                 <span class="va">inherit.aes</span> <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                                 <span class="va">crs</span> <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">ref_df</span><span class="op">)</span>,</span>
<span>                                 <span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span></span>
<span><span class="va">ref_df_w_bb_and_xy_centers</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">ref_df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>bb <span class="op">=</span></span>
<span>                  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">geometry</span>,</span>
<span>                             <span class="va">return_st_bbox_df</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">bb</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">add_xy_coords</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">ref_df_w_bb_and_xy_centers</span><span class="op">$</span><span class="va">id_col</span> <span class="op">&lt;-</span> <span class="va">ref_df_w_bb_and_xy_centers</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">compute_panel_geo</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">scales</span>, <span class="va">keep</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">drop</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="va">stamp</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">ref_df_w_bb_and_xy_centers</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">id_col</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">drop</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">stamp</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="va">ref_df_w_bb_and_xy_centers</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">id_col</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">drop</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">out</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">StatTempsf</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggproto.html" class="external-link">ggproto</a></span><span class="op">(</span>`_class` <span class="op">=</span> <span class="st">"StatTempsf"</span>,</span>
<span>                                `_inherit` <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="https://ggplot2.tidyverse.org/reference/ggplot2-ggproto.html" class="external-link">Stat</a></span>,</span>
<span>                                required_aes <span class="op">=</span> <span class="va">required_aes</span>,</span>
<span>                                compute_panel <span class="op">=</span> <span class="va">compute_panel_geo</span>,</span>
<span>                               default_aes <span class="op">=</span> <span class="va">default_aes</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">geom</span><span class="op">)</span><span class="op">)</span><span class="op">{</span><span class="va">geom</span> <span class="op">&lt;-</span> <span class="va">geom_default</span><span class="op">}</span></span>
<span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/layer_sf.html" class="external-link">layer_sf</a></span><span class="op">(</span></span>
<span>              stat <span class="op">=</span> <span class="va">StatTempsf</span>,  <span class="co"># proto object from step 2</span></span>
<span>              geom <span class="op">=</span> <span class="va">geom</span>,  <span class="co"># inherit other behavior</span></span>
<span>              data <span class="op">=</span> <span class="va">data</span>,</span>
<span>              mapping <span class="op">=</span> <span class="va">mapping</span>,</span>
<span>              position <span class="op">=</span> <span class="va">position</span>,</span>
<span>              show.legend <span class="op">=</span> <span class="va">show.legend</span>,</span>
<span>              inherit.aes <span class="op">=</span> <span class="va">inherit.aes</span>,</span>
<span>              params <span class="op">=</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/list2.html" class="external-link">list2</a></span><span class="op">(</span>na.rm <span class="op">=</span> <span class="va">na.rm</span>, <span class="va">...</span><span class="op">)</span></span>
<span>              <span class="op">)</span>,</span>
<span>              </span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="va">crs</span>,</span>
<span>                       default_crs <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">crs</span><span class="op">)</span>,</span>
<span>                       datum <span class="op">=</span> <span class="va">crs</span>,</span>
<span>                       default <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>     <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level3">
<h3 id="try-it-out-1">Try it out<a class="anchor" aria-label="anchor" href="#try-it-out-1"></a>
</h3>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"shape/nc.shp"</span>, package<span class="op">=</span><span class="st">"sf"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>county_name <span class="op">=</span> <span class="va">NAME</span>,</span>
<span>                fips <span class="op">=</span> <span class="va">FIPS</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">county_name</span>, <span class="va">fips</span>, <span class="va">geometry</span><span class="op">)</span> <span class="op">-&gt;</span></span>
<span><span class="va">nc_reference</span></span>
<span><span class="co">#&gt; Reading layer `nc' from data source </span></span>
<span><span class="co">#&gt;   `/Library/Frameworks/R.framework/Versions/4.2/Resources/library/sf/shape/nc.shp' </span></span>
<span><span class="co">#&gt;   using driver `ESRI Shapefile'</span></span>
<span><span class="co">#&gt; Simple feature collection with 100 features and 14 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965</span></span>
<span><span class="co">#&gt; Geodetic CRS:  NAD27</span></span>
<span></span>
<span><span class="va">geom_county2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="fu">define_layer_sf_temp</span><span class="op">(</span>ref_df <span class="op">=</span> <span class="va">nc_reference</span>,</span>
<span>                         required_aes <span class="op">=</span> <span class="st">"fips|county_name"</span>,</span>
<span>                       default_aes <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat</a></span><span class="op">(</span><span class="va">county_name</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                       <span class="va">...</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">ggnorthcarolina</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ggnorthcarolina/man/northcarolina_county_flat.html" class="external-link">northcarolina_county_flat</a></span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fips <span class="op">=</span> <span class="va">fips</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_county2</span><span class="op">(</span><span class="op">)</span>  <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">SID74</span><span class="op">/</span><span class="va">BIR74</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu">geom_county2</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>,</span>
<span>               color <span class="op">=</span> <span class="st">"pink"</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-16-1.png"><!-- --></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  </span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/last_plot.html" class="external-link">last_plot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">BIR74</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-16-2.png"><!-- --></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/last_plot.html" class="external-link">last_plot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_county2</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, </span>
<span>              mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">BIR74</span><span class="op">)</span><span class="op">)</span>  <span class="co">#oh! </span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-16-3.png"><!-- --></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">create_layer_sf_temp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">ref_df</span>, </span>
<span>                                 <span class="va">fun_name</span> <span class="op">=</span><span class="st">"geom_my_sf"</span>, </span>
<span>                                 <span class="va">required_aes</span>, </span>
<span>                                 <span class="va">default_aes</span> <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                                 <span class="va">geom_default</span> <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">GeomSf</a></span>,</span>
<span>                                 <span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html" class="external-link">assign</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">fun_name</span>, </span>
<span>         value <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>           </span>
<span>           </span>
<span>  <span class="fu">define_layer_sf_temp</span><span class="op">(</span>ref_df <span class="op">=</span> <span class="va">ref_df</span>,</span>
<span>    required_aes <span class="op">=</span> <span class="va">required_aes</span>,</span>
<span>    geom_default <span class="op">=</span> <span class="va">geom_default</span>,</span>
<span>    default_aes <span class="op">=</span> <span class="va">default_aes</span>,</span>
<span>    <span class="va">...</span><span class="op">)</span>  <span class="op">}</span>,</span>
<span>  pos <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"shape/nc.shp"</span>, package<span class="op">=</span><span class="st">"sf"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>county_name <span class="op">=</span> <span class="va">NAME</span>,</span>
<span>                fips <span class="op">=</span> <span class="va">FIPS</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">county_name</span>, <span class="va">fips</span>, <span class="va">geometry</span><span class="op">)</span> <span class="op">-&gt;</span></span>
<span><span class="va">my_ref_data</span></span>
<span><span class="co">#&gt; Reading layer `nc' from data source </span></span>
<span><span class="co">#&gt;   `/Library/Frameworks/R.framework/Versions/4.2/Resources/library/sf/shape/nc.shp' </span></span>
<span><span class="co">#&gt;   using driver `ESRI Shapefile'</span></span>
<span><span class="co">#&gt; Simple feature collection with 100 features and 14 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965</span></span>
<span><span class="co">#&gt; Geodetic CRS:  NAD27</span></span>
<span></span>
<span></span>
<span><span class="fu">create_layer_sf_temp</span><span class="op">(</span>ref_df <span class="op">=</span> <span class="va">my_ref_data</span>,</span>
<span>  fun_name <span class="op">=</span> <span class="st">"geom_county"</span>,</span>
<span>  required_aes <span class="op">=</span> <span class="st">"county_name|fips"</span>,</span>
<span>  default_aes <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat</a></span><span class="op">(</span><span class="va">county_name</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">ggnorthcarolina</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ggnorthcarolina/man/northcarolina_county_flat.html" class="external-link">northcarolina_county_flat</a></span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fips <span class="op">=</span> <span class="va">fips</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_county</span><span class="op">(</span><span class="op">)</span>  <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">SID74</span><span class="op">/</span><span class="va">BIR74</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_county</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, </span>
<span>              mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">BIR74</span><span class="op">)</span><span class="op">)</span> <span class="co"># oh ho!!</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-17-1.png"><!-- --></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu">ggnorthcarolina</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ggnorthcarolina/man/northcarolina_county_flat.html" class="external-link">northcarolina_county_flat</a></span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fips <span class="op">=</span> <span class="va">fips</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_county</span><span class="op">(</span><span class="op">)</span>  <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">SID74</span><span class="op">/</span><span class="va">BIR74</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_county</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, color <span class="op">=</span> <span class="st">"pink"</span>,</span>
<span>              check_overlap <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-17-2.png"><!-- --></p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-tmap.github.io/tmap/" class="external-link">tmap</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">NLD_prov</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"NLD_muni"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create geo reference data frame</span></span>
<span><span class="va">NLD_prov</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>prov_code <span class="op">=</span> <span class="va">code</span>, prov_name <span class="op">=</span> <span class="va">name</span>, <span class="va">geometry</span><span class="op">)</span> <span class="op">-&gt;</span></span>
<span><span class="va">netherlands_prov_ref_geo</span></span>
<span></span>
<span></span>
<span><span class="va">NLD_muni</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>muni_code <span class="op">=</span> <span class="va">code</span>, muni_name <span class="op">=</span> <span class="va">name</span>, <span class="va">geometry</span><span class="op">)</span> <span class="op">-&gt;</span></span>
<span><span class="va">netherlands_muni_ref_geo</span></span>
<span></span>
<span><span class="co"># create new geom_* function</span></span>
<span><span class="fu">create_layer_sf_temp</span><span class="op">(</span>ref_df <span class="op">=</span> <span class="va">netherlands_prov_ref_geo</span>,</span>
<span>  fun_name <span class="op">=</span> <span class="st">"geom_nl_prov"</span>,</span>
<span>  required_aes <span class="op">=</span> <span class="st">"prov_name|prov_code"</span>,</span>
<span>  default_aes <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat</a></span><span class="op">(</span><span class="va">prov_name</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">create_layer_sf_temp</span><span class="op">(</span>ref_df <span class="op">=</span> <span class="va">netherlands_muni_ref_geo</span>,</span>
<span>  fun_name <span class="op">=</span> <span class="st">"geom_nl_muni"</span>,</span>
<span>  required_aes <span class="op">=</span> <span class="st">"muni_name|muni_code"</span>,</span>
<span>  default_aes <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat</a></span><span class="op">(</span><span class="va">muni_name</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Make a map</span></span>
<span><span class="va">NLD_prov</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>prov_code <span class="op">=</span> <span class="va">code</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_nl_prov</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_nl_prov</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">pop_15_24</span><span class="op">)</span> </span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-18-1.png"><!-- --></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="va">NLD_muni</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>muni_code <span class="op">=</span> <span class="va">code</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_nl_muni</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_nl_muni</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, </span>
<span>               data <span class="op">=</span> <span class="va">.</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">population</span> <span class="op">&gt;</span> <span class="fl">100000</span> <span class="op">)</span>,</span>
<span>               check_overlap <span class="op">=</span> <span class="cn">T</span>,</span>
<span>               color <span class="op">=</span> <span class="st">"gray80"</span>,</span>
<span>               face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">pop_15_24</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggstamp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggstamp/man/theme_void_fill.html" class="external-link">theme_void_fill</a></span><span class="op">(</span><span class="st">"grey"</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-18-2.png"><!-- --></p>
<!-- # for brain example, stamp? --><!-- ```{r} --><!-- library(ggplot2) --><!-- ggseg::aseg$data |> --><!--   dplyr::filter(!is.na(label)) %>%  --><!--   rename(seg_id = label) -> --><!-- id_and_boundaries --><!-- ggseg::aseg$data |> --><!--   dplyr::filter(!is.na(label)) |> --><!--   sf::st_drop_geometry() -> --><!-- regions_flat --><!-- # th --><!-- id_and_boundaries |> --><!--    dplyr::left_join(regions_flat) |> --><!--    ggplot() + --><!--    geom_sf() +  --><!--    aes(fill = hemi) --><!-- create_layer_sf_temp(id_and_boundaries,  --><!--                      fun_name = "stamp_brain", --><!--                      default_aes = aes(label = after_stat(region)), --><!--                      required_aes = character() --><!--                      ) --><!-- library(ggplot2) --><!-- regions_flat %>% --><!--   ggplot() + --><!--   aes(seg_id = seg_id,  --><!--       fill = region == "amygdala") + --><!--   geom_brain()  --><!-- ``` --><div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rnaturalearth</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html" class="external-link">ne_countries</a></span><span class="op">(</span>  </span>
<span>  scale <span class="op">=</span> <span class="st">"medium"</span>, returnclass <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">continent</span>, <span class="va">geometry</span>, <span class="va">iso_a3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>country_name <span class="op">=</span> <span class="va">name</span>,</span>
<span>         iso3c <span class="op">=</span> <span class="va">iso_a3</span></span>
<span>         <span class="op">)</span>  <span class="op">-&gt;</span></span>
<span><span class="va">ref_data</span></span>
<span></span>
<span><span class="fu">create_layer_sf_temp</span><span class="op">(</span>ref_df <span class="op">=</span> <span class="va">ref_data</span>, </span>
<span>                     fun_name <span class="op">=</span> <span class="st">"geom_country"</span>,</span>
<span>                    required_aes <span class="op">=</span> <span class="st">"country_name|iso3c"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">gapminder</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/gapminder/man/gapminder.html" class="external-link">gapminder</a></span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2002</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>country_name <span class="op">=</span> <span class="va">country</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_country</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_country</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, </span>
<span>               mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">country</span><span class="op">)</span>,</span>
<span>               check_overlap <span class="op">=</span><span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-19-1.png"><!-- --></p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="va">heritage_wide</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2024/2024-02-06/heritage.csv'</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">heritage</span> <span class="op">&lt;-</span> <span class="va">heritage_wide</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, names_to <span class="op">=</span> <span class="st">"year"</span>, values_to <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>country <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">country</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">heritage</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>country_name <span class="op">=</span> <span class="va">country</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_country</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">count</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">year</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_country</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">count</span>, sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-19-2.png"><!-- --></p>
</div>
</div>
<div class="section level1">
<h1 id="part-ii-packaging-and-documentation--">Part II. Packaging and documentation ðŸš§ âœ…<a class="anchor" aria-label="anchor" href="#part-ii-packaging-and-documentation--"></a>
</h1>
<div class="section level2">
<h2 id="phase-1-minimal-working-package">Phase 1. Minimal working package<a class="anchor" aria-label="anchor" href="#phase-1-minimal-working-package"></a>
</h2>
<ul>
<li>Bit A. Created files for package archetecture, running <code>devtools::create(".")</code> in interactive session. âœ…</li>
<li>Bit B. Added roxygen skeleton? ðŸš§</li>
<li>Bit C. Managed dependencies ? ðŸš§</li>
</ul>
<!-- end list --><div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_package.html" class="external-link">use_package</a></span><span class="op">(</span><span class="st">"ggplot2"</span><span class="op">)</span></span></code></pre></div>
<ul><li>Bit D. Moved functions R folder? âœ…</li></ul>
<!-- end list --><div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">readme2pkg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/readme2pkg/man/chunk_to_r.html" class="external-link">chunk_to_r</a></span><span class="op">(</span><span class="st">"define_layer_temp"</span><span class="op">)</span></span>
<span><span class="fu">readme2pkg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/readme2pkg/man/chunk_to_r.html" class="external-link">chunk_to_r</a></span><span class="op">(</span><span class="st">"create_layer_temp"</span><span class="op">)</span></span>
<span><span class="fu">readme2pkg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/readme2pkg/man/chunk_to_r.html" class="external-link">chunk_to_r</a></span><span class="op">(</span><span class="st">"define_layer_sf_temp"</span><span class="op">)</span></span>
<span><span class="fu">readme2pkg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/readme2pkg/man/chunk_to_r.html" class="external-link">chunk_to_r</a></span><span class="op">(</span><span class="st">"create_layer_sf_temp"</span><span class="op">)</span></span></code></pre></div>
<ul><li>Run <code><a href="https://devtools.r-lib.org/reference/check.html" class="external-link">devtools::check()</a></code> and addressed errors. ðŸš§</li></ul>
<!-- end list --><div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/check.html" class="external-link">check</a></span><span class="op">(</span>pkg <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span></code></pre></div>
<ul><li>âœ…</li></ul>
<!-- end list --><div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/build.html" class="external-link">build</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<ul><li>Bit G. Write and test traditional README that uses built package. ðŸš§ âœ…</li></ul>
<p>Install package with:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>remotes<span class="op">::</span><span class="kw">installgithub</span>(<span class="st">"EvaMaeRey/readme2pkg.template"</span>)</span></code></pre></div>
<p>Thenâ€¦</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ggtemp</span><span class="op">)</span>  <span class="co">##&lt;&lt; change to your package name here</span></span>
<span></span>
<span><span class="va">compute_panel_circle</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">scales</span>, <span class="va">n</span> <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html" class="external-link">crossing</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>z <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>around <span class="op">=</span> <span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">z</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">around</span><span class="op">)</span><span class="op">*</span><span class="va">r</span>,</span>
<span>           y <span class="op">=</span> <span class="va">y0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">around</span><span class="op">)</span><span class="op">*</span><span class="va">r</span><span class="op">)</span> </span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">geom_circle_points</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="fu">ggtemp</span><span class="fu">:::</span><span class="fu">define_layer_temp</span><span class="op">(</span></span>
<span>    required_aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x0"</span>, <span class="st">"y0"</span>, <span class="st">"r"</span><span class="op">)</span>,</span>
<span>    compute_panel <span class="op">=</span> <span class="va">compute_panel_circle</span>,</span>
<span>    geom_default <span class="op">=</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="https://ggplot2.tidyverse.org/reference/ggplot2-ggproto.html" class="external-link">GeomPoint</a></span>,</span>
<span>    <span class="va">...</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">cars</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">speed</span>, y0 <span class="op">=</span> <span class="va">dist</span>, r <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_circle_points</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-24-1.png"><!-- --></p>
<ul><li>Bit H. Chosen a license? ðŸš§ âœ…</li></ul>
<!-- end list --><div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/licenses.html" class="external-link">use_mit_license</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<ul><li>Bit I. Add lifecycle badge (experimental)</li></ul>
<!-- end list --><div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/badges.html" class="external-link">use_lifecycle_badge</a></span><span class="op">(</span><span class="st">"experimental"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="phase-2-listen--iterate--">Phase 2: Listen &amp; iterate ðŸš§ âœ…<a class="anchor" aria-label="anchor" href="#phase-2-listen--iterate--"></a>
</h2>
<p>Try to get feedback from experts on API, implementation, default decisions. Is there already work that solves this problem?</p>
</div>
<div class="section level2">
<h2 id="phase-3-let-things-settle">Phase 3: Let things settle<a class="anchor" aria-label="anchor" href="#phase-3-let-things-settle"></a>
</h2>
<div class="section level3"><h3 id="bit-a-settle-on-examples-put-them-in-the-roxygen-skeleton-and-readme--">Bit A. Settle on examples. Put them in the roxygen skeleton and readme. ðŸš§ âœ…<a class="anchor" aria-label="anchor" href="#bit-a-settle-on-examples-put-them-in-the-roxygen-skeleton-and-readme--"></a>
</h3></div>
<div class="section level3">
<h3 id="bit-b-written-formal-tests-of-functions-and-save-to-test-that-folders--">Bit B. Written formal tests of functions and save to test that folders ðŸš§ âœ…<a class="anchor" aria-label="anchor" href="#bit-b-written-formal-tests-of-functions-and-save-to-test-that-folders--"></a>
</h3>
<p>That would look like thisâ€¦</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://testthat.r-lib.org" class="external-link">testthat</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html" class="external-link">test_that</a></span><span class="op">(</span><span class="st">"calc times 2 works"</span>, <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html" class="external-link">expect_equal</a></span><span class="op">(</span><span class="fu">times_two</span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>, <span class="fl">8</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html" class="external-link">expect_equal</a></span><span class="op">(</span><span class="fu">times_two</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">readme2pkg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/readme2pkg/man/chunk_to_tests_testthat.html" class="external-link">chunk_to_tests_testthat</a></span><span class="op">(</span><span class="st">"test_calc_times_two_works"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3"><h3 id="bit-c-added-a-description-and-author-information-in-the-description-file--">Bit C. Added a description and author information in the DESCRIPTION file ðŸš§ âœ…<a class="anchor" aria-label="anchor" href="#bit-c-added-a-description-and-author-information-in-the-description-file--"></a>
</h3></div>
<div class="section level3"><h3 id="bit-d-addressed-all-notes-warnings-and-errors--">Bit D. Addressed <em>all</em> notes, warnings and errors. ðŸš§ âœ…<a class="anchor" aria-label="anchor" href="#bit-d-addressed-all-notes-warnings-and-errors--"></a>
</h3></div>
</div>
<div class="section level2">
<h2 id="phase-4-promote-to-wider-audience">Phase 4. Promote to wider audienceâ€¦<a class="anchor" aria-label="anchor" href="#phase-4-promote-to-wider-audience"></a>
</h2>
<div class="section level3"><h3 id="bit-a-package-website-built--">Bit A. Package website built? ðŸš§ âœ…<a class="anchor" aria-label="anchor" href="#bit-a-package-website-built--"></a>
</h3></div>
<div class="section level3"><h3 id="bit-b-package-website-deployed--">Bit B. Package website deployed? ðŸš§ âœ…<a class="anchor" aria-label="anchor" href="#bit-b-package-website-deployed--"></a>
</h3></div>
</div>
<div class="section level2">
<h2 id="phase-5-hardencommit">Phase 5: Harden/commit<a class="anchor" aria-label="anchor" href="#phase-5-hardencommit"></a>
</h2>
<div class="section level3"><h3 id="submit-to-cran--">Submit to CRAN? ðŸš§ âœ…<a class="anchor" aria-label="anchor" href="#submit-to-cran--"></a>
</h3></div>
</div>
</div>
<div class="section level1">
<h1 id="appendix-reports-environment">Appendix: Reports, Environment<a class="anchor" aria-label="anchor" href="#appendix-reports-environment"></a>
</h1>
<div class="section level2">
<h2 id="description-file-extract">Description file extract<a class="anchor" aria-label="anchor" href="#description-file-extract"></a>
</h2>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># readlines(Description)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="environment">Environment<a class="anchor" aria-label="anchor" href="#environment"></a>
</h2>
<p>Here I just want to print the packages and the versions</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html" class="external-link">capture.output</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">all</span><span class="op">[</span><span class="fl">11</span><span class="op">:</span><span class="fl">17</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] ""                                                                         </span></span>
<span><span class="co">#&gt; [2] "attached base packages:"                                                  </span></span>
<span><span class="co">#&gt; [3] "[1] stats     graphics  grDevices utils     datasets  methods   base     "</span></span>
<span><span class="co">#&gt; [4] ""                                                                         </span></span>
<span><span class="co">#&gt; [5] "other attached packages:"                                                 </span></span>
<span><span class="co">#&gt; [6] " [1] ggtemp_0.0.0.9000    tmap_3.3-4           lubridate_1.9.2     "      </span></span>
<span><span class="co">#&gt; [7] " [4] forcats_1.0.0        stringr_1.5.0        dplyr_1.1.0         "</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="devtoolscheck-report">
<code>devtools::check()</code> report<a class="anchor" aria-label="anchor" href="#devtoolscheck-report"></a>
</h2>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/check.html" class="external-link">check</a></span><span class="op">(</span>pkg <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: R CMD check found WARNINGs</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="non-developer-introduction-to-package-and-test-of-installed-package">Non-developer introduction to package (and test of installed package)<a class="anchor" aria-label="anchor" href="#non-developer-introduction-to-package-and-test-of-installed-package"></a>
</h2>
<p>The goal of the {xxx} package</p>
<p>To install the dev version use the following:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a>remotes<span class="op">::</span><span class="kw">install_github</span>(<span class="st">"owner/repo"</span>) <span class="co"># </span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example-using-package">Example using package<a class="anchor" aria-label="anchor" href="#example-using-package"></a>
</h2>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mypackage</span><span class="op">)</span></span>
<span><span class="fu">myfunction</span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span></code></pre></div>
</div>
</div>

  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing ggtemp</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>First Last <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/YOUR-ORCID-ID" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by First Last.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
